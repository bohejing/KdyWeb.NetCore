function InitVideoPlay(){this._playResultApi="/api/PlayApi/result";this._getDanmuApi="/api/VideoDanMu/get";this._sendDanmuApi="/api/VideoDanMu/create";this.postType={json:0,form:1}}InitVideoPlay.prototype={init:function(n,t,i){n=n||"playercontainer";var r="mp4",f=this,e=f.checkSys(),u="video/mp4";if(t.indexOf(".m3u8")>0?(r="m3u8",u="application/x-mpegURL"):t.indexOf("g3proxy.lecloud.com")>0&&t.indexOf("tss=mp4")===-1?(r="m3u8",u="application/x-mpegURL"):t.indexOf("/m3u8/")>0&&(r="m3u8",u="application/x-mpegURL"),e.ios||e.android||e.ipad){document.getElementById(n).innerHTML='<video id="kdy_video" width="100%" height="100%" controls="controls" autoplay="autoplay" poster="//kdyimg.hcc11.com/Img/1168148903544098816" webkit-playsinline x-webkit-airplay><source src="'+t+'" type="'+u+'"><\/video>';this.autoNext(t);return}if(i!=null&&i>0&&(r==="mp4"||r==="m3u8")){f.intDanMu(n,t,i,r);return}f.initAli(n,!1,t)},initAli:function(n,t,i){n=n||"playercontainer";t=t||!1;var r=new Aliplayer({id:n,source:i,playsinline:!0,trackLog:!1,autoplay:!0,width:"100%",height:"100%",useH5Prism:!1,isLive:t})},intDanMu:function(n,t,i,r){function l(){var n=h._getDanmuApi+"/"+i+"?timestamp="+Math.round(new Date/1e3);CommentLoader(n,abpinst.cmManager)}var h=this,s,u,f,e,c,a,o;if($("#"+n).html(""),$("body").append('<div class="video"><video id="kdy_video" poster="" preload="auto" autobuffer="true" data-setup="{}" webkit-playsinline autoplay="autoplay"><source src="'+t+'"><div><b>您使用的浏览器不支持HTML5视频...<\/b><\/div><\/video><\/div>'),r==="m3u8"){t=t.replace("http://","https://");s=document.getElementById("kdy_video");u=new Hls;u.loadSource(t);u.attachMedia(s);u.on(Hls.Events.MANIFEST_PARSED,function(){s.play()})}$("body").on("error","video source",function(){var n=document.createElement("div");n.innerHTML='<div style="position:relative;top:50%"><div style="position:relative;font-size:16px;line-height:16px;top:-8px">加载视频失败，请刷新、重试或加QQ群：128931211反馈<\/div><\/div>';n.setAttribute("style","width:100%;height:100%;text-align:center;background:rgba(0,0,0,0.8);position:absolute;color:#FFF");document.querySelector(".ABP-Video").insertBefore(n,document.querySelector(".ABP-Video>:first-child"));document.getElementById("info-box").parentNode.removeChild(document.getElementById("info-box"))});f={scale:1,opacity:1,speed:1,useCSS:!1,autoOpacity:!0};e=localStorage.html5Settings||"{}";e=JSON.parse(e);f=Object.assign(f,e);c=ABP.create(document.getElementById(n),{src:{playlist:[{video:document.getElementById("kdy_video")}]},width:"100%",height:"100%",config:f,mobile:isMobile()});window.abpinst=c;l();a=setInterval(l,3e4);$(".shield-enrty")[0].addEventListener("click",shield.show);$(".shield_top .close")[0].addEventListener("click",shield.show);$(".shield_item .add")[0].addEventListener("click",shield.add);abpinst.txtText.disabled=!1;abpinst.playerUnit.addEventListener("sendcomment",function(n){var t={};t.DSize=n.detail.fontsize;t.DColor=n.detail.color;t.Msg=n.detail.message;t.DTime=n.detail.playTime;t.DMode=n.detail.mode;t.EpId=i;kdyCommon.kdySendHttp("post",h._sendDanmuApi,t,function(n){console.log(n)})});abpinst.txtText.style.textAlign="center";o=document.createElement("div");o.className="on";o.appendChild(document.createTextNode("超清"));abpinst.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Defination").appendChild(o);this.autoNext(t)},getApiUrl:function(n,t,i){var r=this,u={},f=n+"/KdyApiDown/Parse";u.url=t;$.ajax({url:f,data:u,type:"POST",dataType:"jsonp",jsonp:"jsonpCallback",jsonpCallback:"success_ck",success:function(n){if(n.Code!==200){$("#play-content").html('<div style="font-size: 25px;color:red;text-align: center">'+n.ErrMsg+"<\/div>");return}var t=r.jie(n.ResultData);r.init("play-content",t,i);n.Player!=null&&n.Player==="potplayer"&&r.setPotPlayer(t)}})},getApiUrlNew:function(n,t,i){var r=this,u={},f=n+"/self-api-v2/parse";u.encodeUrl=t;$.ajax({url:f,data:u,type:"POST",success:function(n){var u=n.success,t;if(n.isSuccess!=null&&(u=n.isSuccess),u==!1){$("#play-content").html('<div style="font-size: 25px;color:red;text-align: center">请稍后重试或联系管理<\/div>');return}t=r.jie(n.url);r.init("play-content",t,i);n.isMultipleAudioTracks&&r.setPotPlayer(t)}})},checkSys:function(){var t={win:!1,mac:!1,ios:!1,android:!1,ipad:!1},n=navigator.platform;return n==null||n.length<=0?t:(n=n.toLowerCase(),t.win=n.indexOf("win")===0,t.mac=n.indexOf("mac")===0,t.ios=n.indexOf("iphone")===0,t.android=n.indexOf("linux")===0,t.ipad=navigator.userAgent.match(/iPad/i)!=null?!0:!1,t)},jie:function(n){return n=this.strRevers(n),n=this.htoStr(n),this.decodeStr(n)},htoStr:function(n){for(var i,r="",t=0;t<n.length;t=t+2)i=n[t]+n[t+1],i=parseInt(i,16),r+=String.fromCharCode(i);return r},strRevers:function(n){return n.split("").reverse()},decodeStr:function(n){var t=(n.length-7)/2,i=n.substring(0,t),r=n.substring(t+7);return i+r},autoNext:function(n){var t=document.getElementById("kdy_video"),i="kdy666."+SparkMD5.hash(n),r=this._dataJson;if(t.addEventListener("ended",function(){var t=r,n={},u=t.data.nextEpId;n.epId=u;n.epId!=null&&n.epId>0&&(window.parent.postMessage(n,"*"),localStorage.removeItem(i),location.href=t.data.nextEpUrl)}),window.localStorage==!1)return!1;t.addEventListener("timeupdate",function(){var n=t.currentTime,u=localStorage.getItem(i),r=parseInt(u);if(n>2){localStorage.setItem(i,n);return}n>0&&n<2&&isNaN(r)===!1&&r>1&&(t.currentTime=r)},!1)},setData:function(n){this._dataJson=n},setPotPlayer:function(n){$("#div_potplayer").show();$("#div_potplayer").html('<a href="potplayer://'+n+'">使用PotPlayer播放<\/a>')}};$(function(){var t={},n;t.epId=epId;n=new InitVideoPlay;kdyCommon.kdySendHttp("POST",n._playResultApi,t,function(t){if(n.setData(t),t.isSuccess===!1){$("#play-content").html('<div style="font-size: 25px;color:red;text-align: center">'+t.msg+"<\/div>");return}if(t.data.extensionParseHost!=null&&t.data.extensionParseHost.length>0){if(t.data.isNewParse){n.getApiUrlNew(t.data.extensionParseHost,t.data.playUrl,t.data.epId);return}n.getApiUrl(t.data.extensionParseHost,t.data.playUrl,t.data.epId);return}var i=n.jie(t.data.playUrl);n.init("play-content",i,t.data.epId)})});